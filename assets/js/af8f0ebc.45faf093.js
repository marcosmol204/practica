"use strict";(self.webpackChunkpractica_docs=self.webpackChunkpractica_docs||[]).push([[1337],{3905:(t,l,n)=>{n.d(l,{Zo:()=>s,kt:()=>p});var e=n(7294);function r(t,l,n){return l in t?Object.defineProperty(t,l,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[l]=n,t}function u(t,l){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(t);l&&(e=e.filter((function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable}))),n.push.apply(n,e)}return n}function o(t){for(var l=1;l<arguments.length;l++){var n=null!=arguments[l]?arguments[l]:{};l%2?u(Object(n),!0).forEach((function(l){r(t,l,n[l])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(l){Object.defineProperty(t,l,Object.getOwnPropertyDescriptor(n,l))}))}return t}function k(t,l){if(null==t)return{};var n,e,r=function(t,l){if(null==t)return{};var n,e,r={},u=Object.keys(t);for(e=0;e<u.length;e++)n=u[e],l.indexOf(n)>=0||(r[n]=t[n]);return r}(t,l);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(t);for(e=0;e<u.length;e++)n=u[e],l.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}var a=e.createContext({}),i=function(t){var l=e.useContext(a),n=l;return t&&(n="function"==typeof t?t(l):o(o({},l),t)),n},s=function(t){var l=i(t.components);return e.createElement(a.Provider,{value:l},t.children)},d={inlineCode:"code",wrapper:function(t){var l=t.children;return e.createElement(e.Fragment,{},l)}},c=e.forwardRef((function(t,l){var n=t.components,r=t.mdxType,u=t.originalType,a=t.parentName,s=k(t,["components","mdxType","originalType","parentName"]),c=i(n),p=r,b=c["".concat(a,".").concat(p)]||c[p]||d[p]||u;return n?e.createElement(b,o(o({ref:l},s),{},{components:n})):e.createElement(b,o({ref:l},s))}));function p(t,l){var n=arguments,r=l&&l.mdxType;if("string"==typeof t||r){var u=n.length,o=new Array(u);o[0]=c;var k={};for(var a in l)hasOwnProperty.call(l,a)&&(k[a]=l[a]);k.originalType=t,k.mdxType="string"==typeof t?t:r,o[1]=k;for(var i=2;i<u;i++)o[i]=n[i];return e.createElement.apply(null,o)}return e.createElement.apply(null,n)}c.displayName="MDXCreateElement"},1079:(t,l,n)=>{n.r(l),n.d(l,{assets:()=>a,contentTitle:()=>o,default:()=>d,frontMatter:()=>u,metadata:()=>k,toc:()=>i});var e=n(7462),r=(n(7294),n(3905));const u={sidebar_position:2,sidebar_label:"Monorepo"},o="Decision: Choosing **Monorepo** approach and tooling",k={unversionedId:"decisions/monorepo",id:"decisions/monorepo",title:"Decision: Choosing **Monorepo** approach and tooling",description:"\ud83d\udcd4 What is it - Choosing the right Monorepo tool and features for the boilerplate",source:"@site/docs/decisions/monorepo.md",sourceDirName:"decisions",slug:"/decisions/monorepo",permalink:"/decisions/monorepo",draft:!1,editUrl:"https://github.com/practicajs/practica/tree/main/docs/docs/decisions/monorepo.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,sidebar_label:"Monorepo"},sidebar:"tutorialSidebar",previous:{title:"Configuration Library",permalink:"/decisions/configuration-library"},next:{title:"OpenAPI",permalink:"/decisions/openapi"}},a={},i=[],s={toc:i};function d(t){let{components:l,...n}=t;return(0,r.kt)("wrapper",(0,e.Z)({},s,n,{components:l,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"decision-choosing-monorepo-approach-and-tooling"},"Decision: Choosing ",(0,r.kt)("strong",{parentName:"h1"},"Monorepo")," approach and tooling"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\ud83d\udcd4 What is it")," - Choosing the right Monorepo tool and features for the boilerplate"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u23f0 Status")," - Open for discussions"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\ud83d\udcc1 Corresponding discussion")," - ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/practicajs/practica/issues/80"},"Here")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\ud83c\udfafBottom-line: our recommendation")," - TBD"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\ud83d\udcca Detailed comparison table")),(0,r.kt)("small",null,"*For some lacking features there is a community package that bridges the gap; For workspace, we evaluated whether most of them support a specific feature"),(0,r.kt)("table",{valign:"top"},(0,r.kt)("tr",null,(0,r.kt)("td",null),(0,r.kt)("td",null,(0,r.kt)("h1",null,"nx")),(0,r.kt)("td",null,(0,r.kt)("h1",null,"Turborepo")),(0,r.kt)("td",null,(0,r.kt)("h1",null,"Lerna")),(0,r.kt)("td",null,(0,r.kt)("h1",null,"workspace (npm, yarn, pnpm)"))),(0,r.kt)("tr",null,(0,r.kt)("td",{colspan:"5",align:"center"},(0,r.kt)("h2",null,"Executive Summary"))),(0,r.kt)("tr",{valign:"top"},(0,r.kt)("td",null,(0,r.kt)("b",null,"Community and maintenance")),(0,r.kt)("td",null,(0,r.kt)("img",{src:"/img/docs/decisions/full.png"}),(0,r.kt)("br",null),(0,r.kt)("br",null),"Huge eco-system and commercial-grade maintenance"),(0,r.kt)("td",null,(0,r.kt)("img",{src:"/img/docs/decisions/full.png"}),(0,r.kt)("br",null),(0,r.kt)("br",null),"Trending, commercial-grade maintenance"),(0,r.kt)("td",null,(0,r.kt)("img",{src:"/img/docs/decisions/partial.png"}),(0,r.kt)("br",null),(0,r.kt)("br",null),"Not maintained anymore"),(0,r.kt)("td",null,(0,r.kt)("img",{src:"/img/docs/decisions/almost-full.png"}),(0,r.kt)("br",null),(0,r.kt)("br",null),"Solid")),(0,r.kt)("tr",{valign:"top"},(0,r.kt)("td",null,(0,r.kt)("b",null,"\u2757Encourage component autonomy")),(0,r.kt)("td",null,(0,r.kt)("img",{src:"/img/docs/decisions/partial.png"}),(0,r.kt)("br",null),(0,r.kt)("br",null),"Packages are highly coupled"),(0,r.kt)("td",null,(0,r.kt)("img",{src:"/img/docs/decisions/almost-full.png"}),(0,r.kt)("br",null),(0,r.kt)("br",null),"Workflow is coupled"),(0,r.kt)("td",null,(0,r.kt)("img",{src:"/img/docs/decisions/almost-full.png"}),(0,r.kt)("br",null),(0,r.kt)("br",null),"npm link bypasses the SemVer"),(0,r.kt)("td",null,(0,r.kt)("img",{src:"/img/docs/decisions/full.png"}),(0,r.kt)("br",null),(0,r.kt)("br",null),"Minor concern: shared NODE_MODULES on the root")),(0,r.kt)("tr",{valign:"top"},(0,r.kt)("td",null,(0,r.kt)("b",null,"Build speed")),(0,r.kt)("td",null,(0,r.kt)("img",{src:"/img/docs/decisions/full.png"}),(0,r.kt)("br",null),(0,r.kt)("br",null),"Smart inference and execution plan, shared dependencies, cache"),(0,r.kt)("td",null,(0,r.kt)("img",{src:"/img/docs/decisions/full.png"}),(0,r.kt)("br",null),(0,r.kt)("br",null),"Smart inference and execution plan, shared dependencies, cache"),(0,r.kt)("td",null,(0,r.kt)("img",{src:"/img/docs/decisions/partial.png"}),(0,r.kt)("br",null),(0,r.kt)("br",null),"Parallel tasks execution, copied dependencies"),(0,r.kt)("td",null,(0,r.kt)("img",{src:"/img/docs/decisions/partial.png"}),(0,r.kt)("br",null),(0,r.kt)("br",null),"Shared dependencies")),(0,r.kt)("tr",{valign:"top"},(0,r.kt)("td",null,(0,r.kt)("b",null,"Standardization")),(0,r.kt)("td",null,(0,r.kt)("img",{src:"/img/docs/decisions/partial.png"}),(0,r.kt)("br",null),(0,r.kt)("br",null),"Non standard Node.js stuff: One single root package.json by default, TS-paths for linking"),(0,r.kt)("td",null,(0,r.kt)("img",{src:"/img/docs/decisions/full.png"}),(0,r.kt)("br",null),(0,r.kt)("br",null),"An external build layer"),(0,r.kt)("td",null,(0,r.kt)("img",{src:"/img/docs/decisions/full.png"}),(0,r.kt)("br",null),(0,r.kt)("br",null),"An external build layer"),(0,r.kt)("td",null,(0,r.kt)("img",{src:"/img/docs/decisions/full.png"}),(0,r.kt)("br",null),(0,r.kt)("br",null),"An external package centralizer")),(0,r.kt)("tr",null,(0,r.kt)("td",{class:"tg-ho3n",colspan:"5",align:"center"},(0,r.kt)("h2",null,"Tasks and build pipeline"))),(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"Run recursive commands (affect a group of packages)")),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes"),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes"),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes"),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes")),(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"\u2757\ufe0fParallel task execution")),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes"),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes"),(0,r.kt)("td",null,(0,r.kt)("br",null),"No"),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes* (Yarn & Pnpm)")),(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"\u2757\ufe0fRealize which packages changed")),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes"),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes"),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes"),(0,r.kt)("td",null,(0,r.kt)("br",null),"No")),(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"\u2757\ufe0fRealize packages that are affected by a change")),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes",(0,r.kt)("br",null),"both through package.json and code"),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes",(0,r.kt)("br",null),"through package.json"),(0,r.kt)("td",null,(0,r.kt)("br",null),"None"),(0,r.kt)("td",null,(0,r.kt)("br",null),"None")),(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"Ignore missing commands/scripts")),(0,r.kt)("td",null,(0,r.kt)("br",null),"No"),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes"),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes"),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes")),(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"\u2757\ufe0fIn-project cache - Skip tasks if local result exists")),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes"),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes"),(0,r.kt)("td",null,(0,r.kt)("br",null),"No"),(0,r.kt)("td",null,(0,r.kt)("br",null),"No")),(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"Remote cache - Skip tasks if remote result exists")),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes"),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes"),(0,r.kt)("td",null,(0,r.kt)("br",null),"No"),(0,r.kt)("td",null,(0,r.kt)("br",null),"No")),(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"Visual dependency graph")),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes"),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes"),(0,r.kt)("td",null,(0,r.kt)("br",null),"Partially, via plugin"),(0,r.kt)("td",null,(0,r.kt)("br",null),"No")),(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"\u2757\ufe0fSmart waterfall pipeline - Schedule unrelated tasks in parallel, not topologically")),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes"),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes"),(0,r.kt)("td",null,(0,r.kt)("br",null),"No"),(0,r.kt)("td",null,(0,r.kt)("br",null),"No")),(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"Distributed task execution - Spread tasks across machines")),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes"),(0,r.kt)("td",null,(0,r.kt)("br",null),"No"),(0,r.kt)("td",null,(0,r.kt)("br",null),"No"),(0,r.kt)("td",null,(0,r.kt)("br",null),"No")),(0,r.kt)("tr",null,(0,r.kt)("td",{class:"tg-ho3n",colspan:"5",align:"center"},(0,r.kt)("h2",null,"Locally linking packages"))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"\u2757\ufe0fIs supported"),(0,r.kt)("td",null,"Partially",(0,r.kt)("br",null),"Achieved through TS paths"),(0,r.kt)("td",null,(0,r.kt)("br",null),"No",(0,r.kt)("br",null),"Relies on workspaces"),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes"),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes")),(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"How")),(0,r.kt)("td",null,(0,r.kt)("br",null),"\u2757\ufe0fVia TypeScript paths and webpack"),(0,r.kt)("td",null,(0,r.kt)("br",null),"Relies on workspaces"),(0,r.kt)("td",null,(0,r.kt)("br",null),"Symlink"),(0,r.kt)("td",null,(0,r.kt)("br",null),"Symlink")),(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"\u2757\ufe0fCan opt-out?")),(0,r.kt)("td",null,"Yes",(0,r.kt)("br",null),"By default local packages are linked"),(0,r.kt)("td",null,"-"),(0,r.kt)("td",null,"No"),(0,r.kt)("td",null,"Partially",(0,r.kt)("br",null),"Pnpm allows preferring remote packages, Yarn has a [focused package](https://classic.yarnpkg.com/blog/2018/05/18/focused-workspaces/) option which only works per a single package")),(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"Link a range - only specific versions will be symlinked")),(0,r.kt)("td",null,"No"),(0,r.kt)("td",null,"-"),(0,r.kt)("td",null,"No"),(0,r.kt)("td",null,"Some",(0,r.kt)("br",null),"Yarn and Pnpm allows workspace versioning")),(0,r.kt)("tr",null,(0,r.kt)("td",{class:"tg-ho3n",colspan:"5",align:"center"},(0,r.kt)("h2",null,"Optimizing dependencies installation speed"))),(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"Supported")),(0,r.kt)("td",null,"Yes",(0,r.kt)("br",null),"Via a single Root package.json and NODE_MODULES"),(0,r.kt)("td",null,"Yes",(0,r.kt)("br",null),"Via caching"),(0,r.kt)("td",null,"No",(0,r.kt)("br",null),"Can be used on top of yarn workspace"),(0,r.kt)("td",null,"Yes",(0,r.kt)("br",null),"Via single node_modules folder")),(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"Retain origin file path (some module refers to relative paths)")),"****",(0,r.kt)("td",null,"Partially",(0,r.kt)("br",null),"NODE_MODULES is on the root, not per package"),(0,r.kt)("td",null,"Yes"),(0,r.kt)("td",null,"Not relevant"),(0,r.kt)("td",null,"Partially",(0,r.kt)("br",null),"Pnpm uses hard link instead of symlinks")),(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"Keep single NODE_MODULES per machine (faster, less disc space)")),(0,r.kt)("td",null,"No",(0,r.kt)("br",null)),(0,r.kt)("td",null,"No"),(0,r.kt)("td",null,"No"),(0,r.kt)("td",null,"Partially",(0,r.kt)("br",null),"Pnpm supports this")),(0,r.kt)("tr",null,(0,r.kt)("td",{class:"tg-ho3n",colspan:"5",align:"center"},(0,r.kt)("h2",null,"Other features and considerations"))),(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"Community plugins")),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes"),(0,r.kt)("td",null,(0,r.kt)("br",null),"No"),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes"),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes")),(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"Scaffold new component from a gallery")),(0,r.kt)("td",null,(0,r.kt)("br",null),"Yes"),(0,r.kt)("td",null,(0,r.kt)("br",null),"None"),(0,r.kt)("td",null,(0,r.kt)("br",null),"None"),(0,r.kt)("td",null,(0,r.kt)("br",null),"None"),(0,r.kt)("td",null,"Create a new package to the repo"),(0,r.kt)("td",null,(0,r.kt)("br",null),"Built it code genreation with useful templates"),(0,r.kt)("td",null,(0,r.kt)("br",null),"None, 3rd party code generator can be used"),(0,r.kt)("td",null,(0,r.kt)("br",null),"None, 3rd party code generator can be used"),(0,r.kt)("td",null,(0,r.kt)("br",null),"None, 3rd party code generator can be used")),(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"Adapt changes in the monorepo tool")),(0,r.kt)("td",null,(0,r.kt)("br",null),"Supported via nx migrate"),(0,r.kt)("td",null,(0,r.kt)("br",null),"Supported via codemod"),(0,r.kt)("td",null,(0,r.kt)("br",null),"None"),(0,r.kt)("td",null,(0,r.kt)("br",null),"None")),(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"Incremental builds")),(0,r.kt)("td",null,(0,r.kt)("br",null),"Supported"),(0,r.kt)("td",null,(0,r.kt)("br",null),"Supported"),(0,r.kt)("td",null,(0,r.kt)("br",null),"None"),(0,r.kt)("td",null,(0,r.kt)("br",null),"None")),(0,r.kt)("tr",null,(0,r.kt)("td",null,(0,r.kt)("b",null,"Cross-package modifications")),(0,r.kt)("td",null,(0,r.kt)("br",null),"Supported via nx generate"),(0,r.kt)("td",null,(0,r.kt)("br",null),"None"),(0,r.kt)("td",null,(0,r.kt)("br",null),"None"),(0,r.kt)("td",null,(0,r.kt)("br",null),"None"))),(0,r.kt)("p",null,"__"),(0,r.kt)("p",null,"Ideas for next iteration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Separate command execution and pipeline section"),(0,r.kt)("li",{parentName:"ul"},"Stars and popularity"),(0,r.kt)("li",{parentName:"ul"},"Features summary"),(0,r.kt)("li",{parentName:"ul"},"Polyrepo support")))}d.isMDXComponent=!0}}]);